<!-- pages/profile/profile.wxml -->

<view class="profile-container">

<!-- 用户信息头部 -->

<view class="profile-header">

<view class="user-avatar" bindtap="openAvatarPicker">
  <text class="avatar-emoji">{{userInfo.avatarUrl || '😊'}}</text>
</view>

<view class="user-info">
  <text class="user-name" bindtap="changeNickName">{{userInfo.nickName || '点击登录'}}</text>
</view>

<view class="settings-btn" bindtap="goToSettings">⚙️</view>

</view>

<!-- 加载状态 -->

<view class="loading-state" wx:if="{{loading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">加载中...</text>
</view>

<!-- 我的订单 -->

<view class="section-card">
  <view class="section-header" bindtap="goToOrders">
    <view class="section-title">
      <text class="section-icon">📦</text>
      <text class="section-text">我的订单</text>
    </view>
    <text class="section-more">查看全部 ></text>
  </view>
  
  <view class="order-status">
    <view class="status-item" bindtap="goToOrders" data-status="pending">
      <view class="status-icon">⏳</view>
      <text class="status-text">待付款</text>
    </view>
    <view class="status-item" bindtap="goToOrders" data-status="shipping">
      <view class="status-icon">🚚</view>
      <text class="status-text">待发货</text>
    </view>
    <view class="status-item" bindtap="goToOrders" data-status="delivered">
      <view class="status-icon">📦</view>
      <text class="status-text">待收货</text>
    </view>
    <view class="status-item" bindtap="goToOrders" data-status="completed">
      <view class="status-icon">✅</view>
      <text class="status-text">已完成</text>
    </view>
  </view>
</view>

<!-- 我的功能 -->

<view class="section-card">
  <view class="section-header">
    <view class="section-title">
      <text class="section-icon">⭐</text>
      <text class="section-text">我的功能</text>
    </view>
  </view>
  
  <view class="function-grid">
    <view class="function-item" bindtap="goToCollection">
      <view class="function-icon">❤️</view>
      <text class="function-text">我的收藏</text>
    </view>
    <view class="function-item" bindtap="goToAddress">
      <view class="function-icon">📍</view>
      <text class="function-text">收货地址</text>
    </view>
    <view class="function-item" bindtap="goToCoupons">
      <view class="function-icon">🎫</view>
      <text class="function-text">优惠券</text>
      <view class="function-badge" wx:if="{{couponCount > 0}}">{{couponCount}}</view>
    </view>
    <view class="function-item" bindtap="goToPets">
      <view class="function-icon">🐾</view>
      <text class="function-text">我的宠物</text>
    </view>
    <view class="function-item" bindtap="goToService">
      <view class="function-icon">💬</view>
      <text class="function-text">客服中心</text>
    </view>
  </view>
</view>

<!-- 工具和服务 -->

<view class="section-card">
  <view class="section-header">
    <view class="section-title">
      <text class="section-icon">🛠️</text>
      <text class="section-text">工具与服务</text>
    </view>
  </view>
  
  <view class="service-list">
    <view class="service-item" bindtap="goToHealthCheck">
      <view class="service-icon">🏥</view>
      <view class="service-info">
        <text class="service-title">宠物健康检查</text>
        <text class="service-desc">在线评估宠物健康状况</text>
      </view>
      <text class="service-arrow">></text>
    </view>
    <view class="service-item" bindtap="goToVaccine">
      <view class="service-icon">💉</view>
      <view class="service-info">
        <text class="service-title">疫苗提醒</text>
        <text class="service-desc">记录宠物疫苗接种时间</text>
      </view>
      <text class="service-arrow">></text>
    </view>
    <view class="service-item" bindtap="goToFuneral">
      <view class="service-icon">🕊️</view>
      <view class="service-info">
        <text class="service-title">宠物丧葬</text>
        <text class="service-desc">为宠物提供专业丧葬服务</text>
      </view>
      <text class="service-arrow">></text>
    </view>
  </view>
</view>

<!-- 退出登录 -->

<view class="logout-btn" bindtap="logout">
  <text>退出登录</text>
</view>

<!-- Emoji 头像选择器 -->

<view class="avatar-picker-mask" wx:if="{{showAvatarPicker}}" bindtap="closeAvatarPicker">
  <view class="avatar-picker-content" catchtap="stopPropagation">
    <view class="picker-header">
      <text class="picker-title">选择头像</text>
      <text class="picker-close" bindtap="closeAvatarPicker">✕</text>
    </view>
    
    <view class="emoji-grid">
      <block wx:for="{{emojiAvatars}}" wx:key="index">
        <view class="emoji-item {{userInfo.avatarUrl === item ? 'selected' : ''}}" 
              bindtap="selectEmojiAvatar" data-emoji="{{item}}">
          <text class="emoji-icon">{{item}}</text>
        </view>
      </block>
    </view>
    
    <view class="picker-footer">
      <text class="picker-tip">点击选择一个 Emoji 作为头像</text>
    </view>
  </view>
</view>

</view>